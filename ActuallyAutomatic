from google import genai
from PIL import Image
from io import BytesIO

# Configure the client with your API key
client = genai.Client(api_key="")

person = input("Who would you like impersonate? \na for Ariel, r for Rapunzel, j for Jasmine, e for Elsa: \n")



if person == "a":
    image = Image.open("/Users/sehyunk/Desktop/AI_Internship/Images/Ariel.png") 
    image2 = Image.open("/Users/sehyunk/Desktop/AI_Internship/Images/Ariel.png") 
if person == "r":
    image = Image.open("/Users/sehyunk/Desktop/AI_Internship/Images/Rapunzel.png")
    image2 = Image.open("/Users/sehyunk/Desktop/AI_Internship/Images/Rapunzel.png")
if person == "j":
    image = Image.open("/Users/sehyunk/Desktop/AI_Internship/Images/Jasmine.png")
    image2 = Image.open("/Users/sehyunk/Desktop/AI_Internship/Images/Jasmine.png")
if person == "e":
    image = Image.open("/Users/sehyunk/Desktop/AI_Internship/Images/Elsa.png")
    image2 = Image.open("/Users/sehyunk/Desktop/AI_Internship/Images/Elsa.png")  
    
face = input("Which face would you like to use? \ntype 1, 2, or 3 or e for the example picture: \n")
if face == "1":
    image1 = Image.open("/Users/sehyunk/Desktop/AI_Internship/Images/face.png")
if face == "2":
    image1 = Image.open("/Users/sehyunk/Desktop/AI_Internship/Images/face2.png")
if face == "3":
    image1 = Image.open("/Users/sehyunk/Desktop/AI_Internship/Images/face3.png")
if face == "e":
    image1 = Image.open("/Users/sehyunk/Desktop/AI_Internship/Images/Example.png")

prompt = """Remove everything from both the background and the person, but you must absolutely keep only the clothes in the image"""

# Pass both the text prompt and the image in the 'contents' list
response = client.models.generate_content(
    model="gemini-2.5-flash-image",
    contents=[prompt, image],
)

for part in response.candidates[0].content.parts:
    if part.text is not None:
        print(part.text)
    elif part.inline_data is not None:
        image2 = Image.open(BytesIO(part.inline_data.data))
        image2.save("headless.png")
        image2 = Image.open("/Users/sehyunk/AI_Internship/headless.png")
        print ("STEP 0.5 COMPLETE")
prompt = """Change the entire background to a solid black background including any hair and furniture, only keeping the person. Then, turn the person's head only into a white mannequin, while keeping the person's pose.
The mannequin should no have any clothing. Assume that any same-colored objects connected to the hair is also hair and remove it all. Make sure that the hands lack detail, so remove shadowing, remove the fingernails, and remove the joint marks. Keep eye socket shadowing however. """

# Pass both the text prompt and the image in the 'contents' list
response = client.models.generate_content(
    model="gemini-2.5-flash-image",
    contents=[prompt, image],
)

for part in response.candidates[0].content.parts:
    if part.text is not None:
        print(part.text)
    elif part.inline_data is not None:
        image = Image.open(BytesIO(part.inline_data.data))
        image.save("mannequin.png")
        image = Image.open("/Users/sehyunk/AI_Internship/mannequin.png")
        print ("STEP 1 COMPLETE")
prompt = """Create an estimated body of the person wearing the given clothes and copying the mannequin's exact pose. Don't change the hair. Keep the background something simple. GO as close as you can to the face while still including the body until the knees"""

# Pass both the text prompt and the image in the 'contents' list
response = client.models.generate_content(
    model="gemini-2.5-flash-image",
    contents=[prompt, image, image2],
)

for part in response.candidates[0].content.parts:
    if part.text is not None:
        print(part.text)
    elif part.inline_data is not None:
        image1 = Image.open(BytesIO(part.inline_data.data))
        image1.save("body.png")
        image1 = Image.open("/Users/sehyunk/AI_Internship/body.png")
        print ("STEP 2 COMPLETE")

prompt = """Have this person be in the empty background while matching her face to the white outline and estimated body to the bolded outline and wearing the clothes given. The person shouldn't look like a drawing but realistic. Keep the model's hairstyle. Keep the outline's clothes and background. There should be absolutely none of the bolded outline remaining"""

# Pass both the text prompt and the image in the 'contents' list
response = client.models.generate_content(
    model="gemini-2.5-flash-image",
    contents=[prompt, image, image1],
)

for part in response.candidates[0].content.parts:
    if part.text is not None:
        print(part.text)
    elif part.inline_data is not None:
        image = Image.open(BytesIO(part.inline_data.data))
        image.save("finished.png")
        print ("STEP 3 COMPLETE")

prompt = """Change the black background to the other one. Beware for any extremely long hair that may look like part of the background, and make sure to filter it out. We don't want some other person's hair intruding in the black ground. additionally remove any bolded black outline, which will look like a thin black line on the body."""

# Pass both the text prompt and the image in the 'contents' list
response = client.models.generate_content(
    model="gemini-2.5-flash-image",
    contents=[prompt, image, image2],
)

for part in response.candidates[0].content.parts:
    if part.text is not None:
        print(part.text)
    elif part.inline_data is not None:
        image = Image.open(BytesIO(part.inline_data.data))
        image.save("ActuallyFinished.png")
        print ("DONE")





